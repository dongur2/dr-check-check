# 05. 프로세스 동기화

## 프로세스 간 통신

### 1. **프로세스 간 통신이란?**

이전에 배웠듯 서로 다른 프로세스들은 사용하는 메모리의 영역이 다르기 때문에 공유된 메모리를 통해서 통신하는 것에 어려움이 있다. 그래서 특수한 통신 방법을 필요로 하고 이것을 프로세스 간 통신 ( IPC: Inter Process Communication ) 이라고 한다.

방법으로 나누자면 크게 메모리 영역이나 피알을 공유하는 방식, 파이프를 이용한 통신, 소켓을 이용한 통신 세가지로 나눌 수 있음

### 메모리 공유 통신 : 단방향 통신이며 대기가 없는 통신

### 파이프 통신 : 단방향 통신이며 대기가 있는 통신

### 소켓 통신 : 양방향 통신이며 대기가 있는 통신

여러 컴퓨터에 있는 프로세스끼리도 통신을 하는 **네트워킹** 의 영역
여러 컴퓨터가 소통할 때, 클라이언트 사이드에서는 서버 사이드와 통신할 때 포트 번호가 할당되어 있는 프로세스로 연결 -> 데몬이라고 함.

데몬은 소켓을 사용하여 여러 클라이언트에 서비스를 제공한다.

### 2. **공유 자원과 임계구역**

> 공유 자원 : 여러 프로세스가 공동으로 이용하는 변수, 메모리, 파일 등

> 임계 구역 : 공유 자원 접근 순서에 따라 실행 결과가 달라지는 프로그램의 영역

- 임계구역 문제 해결 조건 3가지
  1. 상호 배제( mutual exclusion )
     -> 한 프로세스가 임계구역에 들어갔을 때 다른 프로세스의 접근을 막아버림
     -> lock(잠금) 으로 해결
  2. 한정 대기( bounded waiting )
     -> 어떤 프로세스도 임계구역에 진입하지 못하여 무한 대기를 하면 안됨
  3. 진행의 융통성 ( progress flexibility )
     -> 한 프로세스가 다른 프로세스의 진행을 방해해서는 안된다

### 3. **임계구역 문제 해결 방법**

> 교착 상태(deadlock) : 프로세스가 살아 있으나 작업이 진행되지 못하는 상태

### 피터슨 알고리즘

프로세스를 두개로 나눠
P1
lock1=true;
turn=2;
While(lock2==true&&turn==2);
--임계구역--
lock1=false;

P1
lock2=true;
turn=1;
While(lock1==true&&turn==1);
--임계구역--
lock2=false;

lock 과 turn 이라는 공유변수 두개로 묶어 조건 3개를 해결하는 임계구역 문제해결법. 공유변수가 두개라 약점을 보완 가능.
다만 2개의 프로세스에서만 쓸 수 있음

### 데커 알고리즘

P1
lock1=ture;
while(lock2==true){
if(turn==2){
lock1=false;
while(turn==2);
lock1=true;
}
}
임계구역
turn=2;
lock1=false;

P2
lock2=ture;
while(lock1==true){
if(turn==1){
lock2=false;
while(turn==1);
lock2=true;
}
}
임계구역
turn=1;
lock2=false;

근데 이런 임계구역 문제 해결에서 조건을 모두 만족했더라도 프로세스가 늘어나는 것 자체가 바람직하지 않음
-> 코드 자체도 그렇게 중요한지 잘 모르겠음.

### 세마포어 알고리즘

세마포어 알고리즘 내부에는 세마포어 변수 RS가 사용되는데, RS는 현재 사용 가능한 자원의 수를 나타냄. Semaphore(n) 은 내부 변수 RS를 n으로 초기화하고, P() 는 임계구역에 진입하기 전에 사용하는 함수이고, V() 는 임계구역에서 빠져나올 때 사용하는 함수임
->변수 하나를 프로세스에 진입할 때 1 증가시키고(lock) 나올 때 1 낮추는 알고리즘

//wait
procedure P(S) --> 최초 S값은 1임
while S=0 do wait --> S가 0면 1이 될때까지 기다려야 함
S := S-1 --> S를 0로 만들어 다른 프로세스가 들어 오지 못하도록 함
end P

--- 임계 구역 ---
//signal
procedure V(S) --> 현재상태는 S가 0임
S := S+1 --> S를 1로 원위치시켜 해제하는 과정
end V
