# 3장 프로세스와 스레드
## 01 프로세스의 개요

프로세스 처리 과정, 프로세스 제어 블록, 스레드의 역할

### 1. 프로세스의 개념

1. 프로그램과 프로세스
> 프로그램
- 어떤 데이터를 사용하여 어떤 작업을 할지 그 절차를 적어 놓은 것
> 프로세스
- 프로그램으로 작성된 작업 절차를 실행에 옮긴다
- **프로그램 실행을 위해 메모리에 올라온 동적인 상태**


### 2. 프로그램에서 프로세스로의 전환

1. **프로세스 제어 블록 Process Control Block(PCB)**
- 주문서에 해당하는 **작업 지시서**
- 어떤 프로그램이 프로세스가 되었다는 것은 운영체제로부터 프로세스 제어 블록을 받았다는 의미
2. 프로세스 제어 블록의 정보

**프로세스 구분자**

- ID; IDentification

**메모리 관련 정보**

- 프로세스의 메모리 위치 정보
- 메모리 보호를 위한 경계 레지스터와 한계

**각종 중간 값**

- 프로세스가 사용했던 중간값이 저장됨 = 어떤 요리까지 손님한테 제공 되었는지에 대한 것
1. 프로세스와 프로그램의 관계
- 프로세스 = 프로그램 + 프로세스 제어 블록
- 프로세스 = 프로개름 - 프로세스 제어 블록

### 3. 프로세스의 상태

1. 일괄 작업 시스템
- 프로세스 생성 → CPU 실행 → 종료
- 상태
    - 생성
    - 실행
    - 완료
2. 시분할 시스템 → 다시 읽기
- CPU를 얻어 실행 중인 프로세스가 중간에 다른 프로세스에 CPU를 넘겨주는 일이 빈번하게 발생
3. 프로세스의 다섯 가지 상태

| 상태 | 설명 |
| --- | --- |
| 생성 | 저장 장치에 저장된 프로그램이 메모리로 올라와 실행되어 프로세스가 되는 상태로 커널 영역에 프로세스 제어 블록이 만들어진다. 생성된 후에는 준비 상태로 이동한다. |
| 준비 | 실행을 기다리는 모든 프로세스가 준비 큐에서 자기 차례를 기다리는 상태다. 실행될 프로세스를 CPU 스케줄러가 선택한다. |
| 실행 상태 | 선택된 프로세스가 타임 슬라이스를 얻어 CPU를 사용하는 상태다. 작업을 마치면 완료 상태로 가고 작업을 끝내지 못하면 준비 상태로 되돌아간다. CPU 스케줄러는 새로운 프로세스를 실행 상태로 가져온다.(디스패치) |
| 대기 상태 | 실행 상태에 있는 프로세스가 입출력을 요청하면 입출력이 완료될 때까지 기다리는 상태다. 입출력이 완료되면 준비 상태로 이동한다. |
| 완료 상태 | 프로세스가 종료된 상태다. 사용하던 모든 자원은 반납되고, 메모리에서 지워지며, 프로세스 제어 블록은 폐기된다. |
4. 휴식 상태와 보류 상태
- 휴식 상태: 프로세스가 일시적으로 쉬는 상태
- 보류 상태: 프로세스가 메모리에서 잠시 쫓겨난 상태
    - 메모리 밖으로 쫓겨나 스왑 영역에 보관

## 02 프로세스 제어 블록과 문맥 교환

### 1. 프로세스 제어 블록

1. 정의
- 프로세스의 중요한 정보를 보관하고, 실행되면 폐기된다.

2. 구성

- 포인터
    - 프로세스 제어 블록의 첫 번째 블록에 위치.
    - 준비 및 대기 상태의 큐를 구현 시 사용
- 프로그램 카운터: 명령어의 위치를 가리키는 PC의 값 저장
- 각종 레지스터 정보: 이전 실행 시 사용한 레지스터 값을 보관해야 다음에 실행 가능하므로, 레지스터의 중간 값을 보관

### 2. 문맥 교환

1. 의미
- CPU를 차지하던 프로세스가 나가고 새로운 프로세스를 받아들이는 작업
2. 과정
- 프로세스 1이 주어진 시간 다 사용하여 타임아웃되면, 그때까지 했던 작업 결과 저장되고 쫓겨남
- 준비상태였던 프로세스2가 PCB가 채워져 다음 작업 시행

## 03 프로세스의 연산

### 1. 프로세스의 구조

1. 구조
- 코드 영역: 프로세스 본문이 기술되어 있음
- 데이터 영역: 읽/쓰 가능
- 스택 영역: 부가적인 데이터 모아 놓은 곳

### 2. 프로세스의 생성과 복사 fork()

1. fork()시스템 호출의 개념
- 새로운 프로세스를 생성하는 함수
- 복사하는 함수
2. fork()시스템 호출의 동작 과정

3. 장점
- 프로세스의 생성 속도가 빠르다
- 자원 상속 EASY
- 시스템 관리 효율적으로 가능

### 3. 프로세스의 전환 exec()

1. 개념
- fork가 부모와 똑같은 라면을 만드는 거라면, exec은 라면에 fork와 exec을 같이 사용해서 새로운 우동을 만드는 것
- 즉, 프로세스는 그대로 둔 채 내용만 바꾸는 시스템 호출
2. 과정
- 기존 프로세스 구조를 그대로 둔 채 내용만 바꾸어 새로 실행
3. 예
- 프로세스가 실행하는 도중에도 뮤직 플레이어, 워드프로세서와 같은 다른 프로세스 실행 가능

### 4. 프로세스 계층 구조

1. 유닉스의 프로세스 계층 구조
2. 프로세스 계층 구조의 장점
- 여러 작업의 동시 처리
- 용이한 자원 회수
  : 계층 구조로 만들면 프로세스 간 책임 관계 분명해짐

3. 고아 프로세스와 좀비 프로세스
  - 고아 프로세스: 부모 프로세스가 먼저 종료되어 돌아갈 곳 없는 프로세스
  - 좀비 프로세스: 자식 프로세스가 종료되었는데도 부모 프로세스가 뒤처리를 하지 않을 때 발생

## 04 스레드

### 1. 스레드의 개념

1. 스레드의 정의
- CPU가 처리하는 프로세스 작업 단위
- 프로세스보다 훨씬 세부적인 작업
2. 프로세스와 스레드의 차이
- 스레드는 프로세스와 달리 강하게 연결되어 있다
- 멀티스레드: 동시에 작업하는 스레드
    - 프로세스 내 작업을 여러 개의 스레드로 분할해서 작업의 부담을 줄이는 운영 기법

### 2. 멀티스레드의 구조와 예

1. 구조
- 멀티태스킹의 낭비 요소를 제거하기 위해 사용
- 메모리의 여러 곳에 중복되어 메모리 낭비
- 스레드: 가벼운 프로세스

### 3. 멀티스레드의 장단점

1. 장점
- 메모리 낭비 줄여줌
- 하나의 프로세스에서 여러 스레드 사용 시 작업의 효율을 높여준다
2. 단점
- 한 스레드에 문제 생기면 다 생김

### 4. 멀티스레드 모델

1. 사용자 스레드
- 하나의 넷플릭스 아이디 여러 사람이 돌려 사용하는 거랑 비슷한 원리
- 1 to N 모델
- 장점
    - 작업 속도가 빠르다
- 단점
    - 모든 사용자 스레드가 같이 대기
    - 여러 개의 cpu를 동시 사용 불가
    - 보안 취약
2. 커널 스레드
- 하나의 사용자 스레드가 하나의 커널 스레드와 연결
- 1to1 모델
3. 멀티레벨 스레드
- M to N 모델
- 빠르게 움직여야 하는 스레드는 사용자 스레드로, 안정적으로 움직여야 하는 건 커널 스레드로 한다